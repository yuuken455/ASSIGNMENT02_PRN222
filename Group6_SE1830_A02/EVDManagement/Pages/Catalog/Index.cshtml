@page
@model EVDManagement.Pages.Catalog.IndexModel
@{
    ViewData["Title"] = "Cars Catalog";
}

<partial name="_TabCars" model="Model" />

<!-- EDIT MODAL -->
<div class="modal fade" id="carEditModal" tabindex="-1" aria-labelledby="carEditModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <form method="post" asp-page-handler="UpdateCarFull">
                <div class="modal-header">
                    <h5 class="modal-title" id="carEditModalLabel">Edit Car Variant</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <input type="hidden" id="eModelId" name="EditCar.ModelId" />
                    <input type="hidden" id="eVersionId" name="EditCar.VersionId" />
                    <input type="hidden" id="eColorId" name="EditCar.ColorId" />

                    <div class="row g-3">
                        <div class="col-12"><h6 class="text-muted mb-0">Model</h6><hr class="my-2"></div>
                        <div class="col-md-6">
                            <label class="form-label">Model name</label>
                            <input id="eModelName" name="EditCar.ModelName" class="form-control" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Segment</label>
                            <input id="eModelSeg" name="EditCar.Segment" class="form-control" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Description</label>
                            <input id="eModelDesc" name="EditCar.Description" class="form-control" />
                        </div>

                        <div class="col-12 mt-1"><h6 class="text-muted mb-0">Version</h6><hr class="my-2"></div>
                        <div class="col-md-6">
                            <label class="form-label">Version name</label>
                            <input id="eVersionName" name="EditCar.VersionName" class="form-control" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Battery (kWh)</label>
                            <input id="eBatt" name="EditCar.BatteryCapacity" class="form-control" type="number" step="0.1" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Range (km)</label>
                            <input id="eRange" name="EditCar.RangeKm" class="form-control" type="number" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Seat</label>
                            <input id="eSeat" name="EditCar.Seat" class="form-control" type="number" />
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Base price</label>
                            <input id="eBase" name="EditCar.BasePrice" class="form-control" type="number" step="1000" />
                        </div>

                        <div class="col-12 mt-1"><h6 class="text-muted mb-0">Color</h6><hr class="my-2"></div>
                        <div class="col-md-6">
                            <label class="form-label">Color name</label>
                            <input id="eColorName" name="EditCar.ColorName" class="form-control" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Extra cost</label>
                            <input id="eExtra" name="EditCar.ExtraCost" class="form-control" type="number" step="1000" />
                        </div>

                        <div class="col-12 mt-1"><h6 class="text-muted mb-0">Inventory</h6><hr class="my-2"></div>
                        <div class="col-md-3">
                            <label class="form-label">Quantity</label>
                            <input id="eQty" name="EditCar.Quantity" class="form-control" type="number" min="0" />
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function calcFinal(){
          const base  = parseFloat(document.getElementById('base')?.value || 0);
          const extra = parseFloat(document.getElementById('extra')?.value || 0);
          const finalEl = document.getElementById('final');
          if (finalEl) finalEl.value = (base + extra).toFixed(0);
        }
        document.addEventListener('DOMContentLoaded', () => {
          ['base','extra'].forEach(id=>{
            const el=document.getElementById(id);
            if(el) el.addEventListener('input', calcFinal);
          });
          calcFinal();

          const editModal = document.getElementById('carEditModal');
          if (editModal){
            editModal.addEventListener('show.bs.modal', (evt)=>{
              const b = evt.relatedTarget; if(!b) return;
              const ds = b.dataset;
              const setV = (id, v)=>{ const el=document.getElementById(id); if(el) el.value = (v ?? ''); };

              setV('eModelId',   ds.modelId);
              setV('eVersionId', ds.versionId);
              setV('eColorId',   ds.colorId);

              setV('eModelName', ds.modelName);
              setV('eModelSeg',  ds.modelSeg);
              setV('eModelDesc', ds.modelDesc);

              setV('eVersionName', ds.versionName);
              setV('eBatt',   ds.batt);
              setV('eRange',  ds.range);
              setV('eSeat',   ds.seat);
              setV('eBase',   ds.base);

              setV('eColorName', ds.colorName);
              setV('eExtra',     ds.extra);

              setV('eQty', ds.qty);
            });
          }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
}
